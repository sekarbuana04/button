<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login Admin</title>
    <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/vendor/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
      :root{ --header-bg:#1F2A44; }
      body{ font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:#F4F5F7; }
      .login-card{ max-width:420px; margin:10vh auto; border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,0.08); }
      .brand{ background:var(--header-bg); color:#fff; border-radius:14px 14px 0 0; padding:18px 22px; font-weight:700; text-align:center; }
      .actions{ display:flex; justify-content:center; align-items:center; }
      .logo-wrap{ margin-top:8vh; }
      .logo-wrap svg{ filter: drop-shadow(0 8px 22px rgba(0,0,0,0.12)); }
      #msg{ text-align:center; }
    </style>
  </head>
  <body>
    <div class="logo-wrap text-center">
      <svg width="88" height="88" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Operator Counter Graph">
        <circle cx="60" cy="60" r="56" fill="var(--header-bg)" />
        <rect x="38" y="52" width="12" height="26" rx="3" fill="#ffffff" />
        <rect x="56" y="40" width="12" height="38" rx="3" fill="#ffffff" />
        <rect x="74" y="46" width="12" height="32" rx="3" fill="#ffffff" />
        <path d="M38 84 L48 94 L66 76" stroke="#3ECF8E" stroke-width="6" fill="none" stroke-linecap="round" stroke-linejoin="round" />
        <circle cx="60" cy="60" r="56" fill="none" stroke="#ffffff" stroke-opacity="0.15" stroke-width="4" />
      </svg>
    </div>
    <div class="card login-card">
      <div class="brand">Operator Counter â€” Login Admin</div>
      <div class="card-body">
        <form id="loginForm" class="vstack gap-3">
          <div>
            <label class="form-label">Username</label>
            <input type="text" class="form-control" id="username" required />
          </div>
      <div>
        <label class="form-label">Password</label>
        <div class="input-group">
          <input type="password" class="form-control" id="password" required />
          <button class="btn btn-outline-secondary" type="button" id="togglePw" aria-label="Tampilkan/Sembunyikan">
            <i id="eye-icon" class="bi bi-eye"></i>
          </button>
        </div>
      </div>
          <div class="actions">
            <button type="submit" class="btn btn-primary">Masuk</button>
          </div>
          <div id="msg" class="text-danger"></div>
        </form>
      </div>
    </div>

    <script>
      const form = document.getElementById('loginForm');
      const msg = document.getElementById('msg');
      const pw = document.getElementById('password');
      const btn = document.getElementById('togglePw');
      const eyeIcon = document.getElementById('eye-icon');
      btn.addEventListener('click', () => {
        const show = pw.type === 'password';
        pw.type = show ? 'text' : 'password';
        eyeIcon.classList.toggle('bi-eye', !show);
        eyeIcon.classList.toggle('bi-eye-slash', show);
      });
      try {
        const n = sessionStorage.getItem('notify_logout');
        if (n === '1') { alert('Logout berhasil'); sessionStorage.removeItem('notify_logout'); }
      } catch {}
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        msg.textContent = '';
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;
        try {
          const res = await fetch('/api/auth/login', { method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify({ username, password }) });
          const data = await res.json();
          if (!res.ok) { msg.textContent = data.error || 'Login gagal'; return; }
          if (data && data.token) { try { sessionStorage.setItem('sid', data.token); } catch {} }
          const role = data && data.user ? data.user.role : null;
          try {
            if (role === 'line_admin' || role === 'admline') {
              sessionStorage.setItem('route', 'dashboard');
            } else {
              sessionStorage.setItem('route', 'dashboard');
            }
            sessionStorage.setItem('notify_login','1');
          } catch {}
          location.href = '/';
        } catch(err) {
          msg.textContent = 'Terjadi kesalahan jaringan';
        }
      });
    </script>
  </body>
  </html>
